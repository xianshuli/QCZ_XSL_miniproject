<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Matches</title>
    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="/css/carousel.css" rel="stylesheet">
    <link href="/css/jumbotron-narrow.css" rel="stylesheet">
    <script src="/js/bootstrap.min.js"></script>

    <style>
        #table-wrapper2 {
          position:relative;
        }

        #table-scroll2 {
          height:400px;
          overflow:auto;
          margin-top:20px;
        }

        #table-wrapper table thead th .text {
          position:absolute;
          top:-20px;
          z-index:2;
          height:20px;}

        #table-wrapper2 table thead th .text {
          position:absolute;
          top:-20px;
          z-index:2;
          height:20px;}

        [id=targetname]:hover{
        cursor: pointer;
        }
    </style>

</head>
<body style="background-image: url(/img/sky-blue.jpg); background-repeat:no-repeat;background-size:cover;">

<div class="navbar-wrapper">
      <div class="container">
          <nav class="navbar navbar-inverse navbar-static-top">
              <div class="container">
                  <div class="navbar-header">
                      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                      </button>
                      <a class="navbar-brand" href="#">PERFECT roommate</a>
                    </div>
                    <div id="navbar" class="navbar-collapse collapse">
                      <ul class="nav navbar-nav">
                        <li class="active"><a href="/management">Home</a></li>
                        <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Lookaround <span class="caret"></span></a>
                          <ul class="dropdown-menu">
                            <li><a href="JavaScript:centeredPopup(1);">About</a>
                            <li><a href="JavaScript:centeredPopup(2);">Help</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="JavaScript:centeredPopup(3);">Report an Issue</a></li>
                          </ul>
                        </li>

                      </ul>
                      <ul class="nav navbar-nav pull-right">
                        <li><a href="{{ logout_url }}"><button type="button" class="btn btn-danger">Logout</button></a></li>
                      </ul>
                    </div>
              </div>
          </nav>
      </div>

    <div style="position: relative">
        <table width="100%">
            <tr>
                <td width="50%" style="padding: 20px">
                    <div class="panel panel-default" style="background-color: transparent;">
                    <!-- Default panel contents -->
                      <div class="panel-heading text-center">People I Match</div>
                    <div id="table-wrapper2">
                        <div id="table-scroll2">
                         <table class="table">
                             <thead>
                                <tr>
                                      <th width="37%"><span class="text">Name</span></th>
                                      <th width="15%"><span class="text">Gender</span></th>
                                      <th width="15%"><span class="text">Age</span></th>
                                      <th width="15%"><span class="text">School</span></th>
                                      <th width="18%"><span class="text">Let Me Think</span></th>
                                </tr>
                             </thead>
                             <tbody id="personlist">
                                 {% for person in current_matches %}
                                    <tr class="info" id="{{person['ID']}}">
                                        <td onclick="changeRight(this)" id="targetname">{{person['Name']}}</td>
                                        <td>{{person['Gender']}}</td>
                                        <td>{{person['Age']}}</td>
                                        <td>{{person['School']}}</td>
                                        <td>
                                        <div class="checkbox pull-right">
                                            <input type="checkbox" value="">
                                        </div>
                                        </td>
                                    </tr>
                                 {% endfor %}
                             </tbody>
                         </table>
                        </div>
                    </div>
                    </div>

                    <button class="btn btn-primary center-block" type="button" id="addchecked">
                        Add Checked to My Potential List!
                    </button>
                </td>


                <td width="50%" style="padding: 20px">
                    <div class="jumbotron" style="padding-top: 20px; padding-bottom: 10px; margin-top: 0px; margin-bottom: 0px; background-image:url(/img/orangeyellow-background.jpg)">
                            <h3>Your Potential Roommate</h3>
                            <p class="lead">Qingchuan Zhu</p>
                            <p><a class="btn btn-lg btn-success" href="/chatroom" role="button">Let's Chat!</a></p>
                          </div>

                          <div class="row marketing" style="padding-top: 0px; padding-bottom: 0px; margin-top: 0px; margin-bottom: 0px">
                            <div class="col-lg-6">
                              <h4 id="roommate_gender_head" style="padding:4px; display: inline-flex;border-radius:4px;">Roommate Gender</h4>
                              <p id="roommate_gender_choice">{{first_person_setting['roommategender']}}</p>

                              <h4 id="smokingchoice_head" style="padding:4px; display: inline-flex;border-radius:4px;">Smoking Choice</h4>
                              <p id="smokingchoice_choice">{{first_person_setting['smoking_choice']}}</p>

                              <h4 id="overnight_guest_head" style="padding:4px; display: inline-flex;border-radius:4px;">Overnight Guest</h4>
                              <p id="overnight_guest_choice">{{first_person_setting['overnight_guest_choice']}}</p>
                            </div>

                            <div class="col-lg-6">
                              <h4 id="study_habits_head" style="padding:4px; display: inline-flex; border-radius:4px;">Study Habits</h4>
                              <p id="study_habits_choice">{{first_person_setting['study_habits_choice']}}</p>

                              <h4 id="sleep_habits_head" style="padding:4px; display: inline-flex;border-radius:4px;">Sleep Habits</h4>
                              <p id="sleep_habits_choice">{{first_person_setting['sleep_habits_choice']}}</p>

                              <h4 id="cleanliness_head" style="padding:4px; display: inline-flex;border-radius:4px;">Cleanliness</h4>
                              <p id="cleanliness_choice">{{first_person_setting['cleanliness_choice']}}</p>
                            </div>
                          </div>
                </td>

            </tr>
        </table>
    </div>
 </div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<script>
    var usr = '{{usr}}';
    var current_selected_person = '{{first_person_id}}';
    var idmap = {
        1: "roommate_gender_head",
        2: "smokingchoice_head",
        3: "overnight_guest_head",
        4: "study_habits_head",
        5: "sleep_habits_head",
        6: "cleanliness_head"
    };

    var idmap2 = {
        1: "roommate_gender_choice",
        2: "smokingchoice_choice",
        3: "overnight_guest_choice",
        4: "study_habits_choice",
        5: "sleep_habits_choice",
        6: "cleanliness_choice"
    };

    jQuery(document).ready( function($) {
        //alert("current usr = "+usr+" target person = "+current_selected_person)
        highlightmatch();

        $("#addchecked").click( function(e){
            e.preventDefault();

            // record the checked row
                var checkedRow = new Array();
                $("#personlist tr").each( function(index){
                    if($(this).find("input:checkbox").is(":checked")){
                        var target_id = $(this).attr('id');
                        checkedRow.push(target_id);
                    }
                });

            var addPotentialPerson = {
                    potentialPerson : checkedRow
                }

            $.ajax({
               type: 'post',
               url: "/addpotentialpersons",
               data: JSON.stringify(addPotentialPerson),
               success: function (text) {
                    window.location.replace("/management");
               },
               error: function () {
                   alert("Failed on add potential list");
               }
           })

        })
    });

    function highlightmatch(){
        var datastring = "client_ID="+usr+"&target_person="+current_selected_person;
        $.ajax({
               type: "GET",
               url: "/high_light_matches",
               data: datastring,
               success: function (text) {
                   var re = /([1-9])/g;
                   var matchlist = text.match(re);

                   // clear all heading styles
                   clearStyles();

                   for(i = 0; i < matchlist.length; i++){
                       var chandiate_head = idmap[matchlist[i]];
                       var chandiate_choice = idmap2[matchlist[i]];
                       $('#'+chandiate_head).css("backgroundColor","#419641").css("color","white");
                       //$('#'+chandiate_choice).css("color","white")
                   }
               },
               error: function () {
                   alert("Failed on highligh tmatch");
               }
           })
    }

    function changeOptions(){
        var datastring = "target_person="+current_selected_person;
        $.ajax({
               type: "GET",
               url: "/changeoptionsonright",
               data: datastring,
               success: function (text) {
                   var re = /'(.*?)'/g;
                   var res = text.match(re);

                   if(res){
                      for (i = 0; i < res.length; i++) {
                       var choice_in_word = res[i].replace(/'/g, "");
                       document.getElementById(idmap2[i+1]).innerHTML = choice_in_word;
                      }
                   }
               },
               error: function () {
                   alert("Failed on highligh tmatch");
               }
           })
    }

    function clearStyles(){
        $('#roommate_gender_head').css("backgroundColor","transparent").css("color", "#5a5a5a");
        $('#smokingchoice_head').css("backgroundColor","transparent").css("color", "#5a5a5a");
        $('#overnight_guest_head').css("backgroundColor","transparent").css("color", "#5a5a5a");
        $('#study_habits_head').css("backgroundColor","transparent").css("color", "#5a5a5a");
        $('#sleep_habits_head').css("backgroundColor","transparent").css("color", "#5a5a5a");
        $('#cleanliness_head').css("backgroundColor","transparent").css("color", "#5a5a5a")
    }

    function changeRight(elem){
        //alert(elem.parentElement.id);
        var select_guy = elem.parentElement.id;
        current_selected_person = select_guy;
        changeOptions();
        highlightmatch();
    }


</script>

</body>
</html>